#! ./run_once

lb←⌊⌾(÷⟜600)0.62×fr
lp←⌊lb÷4.4
Out ↩ max × 3 Softclip ÷⟜2

q ← lb⌽20 Hp2 Triangle ∾ {∾(𝕩⋆0.1⊸Triangle)⍟(2+↕8) lb⥊𝕩⋆0.9665}¨ 500+8×↕4
Hg← ((2000÷˜5√20+×˜↕460)×⌜↕2×lb){(+˝÷√∘≠)(0.5×0.92⊸⋆⊸⌊𝕗)×1-2|×⟜𝕗}
h ← lb-⊸⌽5300‿1.3 Hp2q ∾Hg¨2000‿2100
s ← (4×lb) ↑ ((0.3×0.6⊸+×0.2⊸⋆)I 16) (⥊×⌜) (0.98⊸⋆×1-˜2|⋆⟜π)↕⌊fr÷21

b ← 0.6 × 170 Lp1 Triangle⌾⌽ ((lb×6‿1÷3.5)⥊˜≠)⊸/ 0‿¯5‿3‿¯4‿0‿¯2‿¯1‿¯6 Trans Note"F#1"
Ws← (0.3×0.8⊸+×0.2⊸⋆)∘I∘⊣ (≠⊸⥊˜×⊢) ((0.6+Square)×0.02 Sine 2⊸×)∘/
w ← (lb÷2) Ws 0‿¯5‿3‿¯1‿5‿3‿2‿3 ‿ 6‿3‿0‿¯4‿10‿8‿5‿1 Trans Note"F#1"
Ls← 1.2e3 Lp1 (0.4⋆1.6√lp÷˜⊒∘⊣) × ·•math.Sin 2.8×Saw∘⊏
l ← 0¨⊸∾ ∾ ((⌊(↕4×lb)÷lp)⌊1-˜≠)⊸Ls¨ ⟨12‿10‿6‿5,3‿5‿8,12‿8‿6.8‿5‿1,3‿¯1‿0⟩ Trans Note"F#4"

(32×lb) Write ⟨q,h,b,l,s⟩

song ← ∾ (32×lb)⊸((+⎉1´⥊⎉1¨)¨) ⟨
  ⟨h,(¯32×lb)↑(24×lb)⥊s,0¨⊸∾(16×lb)⥊b⟩
  ⟨h,s,b,w,l⟩
  ⟨h,s,b,w,  q⟩
  ⟨h,s,b,  l,q⟩
⟩
"l.wav" wav.Write˜ Out Stereo song
