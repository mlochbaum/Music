#! /usr/bin/env dbqn

•state•Eval•FChars"synth.bqn"
lm←16×lb←⌊⌾(÷⟜100)0.66×fr

k ← 0.5  PanAP lb ↑ 1.7×1(-÷+)⋆(¯240⌽(2 Hp1 (⌊4+|∘⊏)⊸⌽)⍟40) 8×((+˝2⋆¯10‿¯15×⌜⊢)∘I × ·(1-×˜)⊸×∘Saw⥊⟜47) fr÷3
s ← 0.54 PanAP (Concat + 0.1×(¯1.5×lb)⌽2 Rep ⊑) 2‿3 ((4×lb)↑Add)∘↑¨ <(-0.76‿1.5‿2.78×lb) Shift¨ (7‿6.7‿5.4÷10) {𝕨×1(-÷+)⋆+´𝕩(+˝Sine∘(⥊×1+0.2÷8⋆I∘⊣)×⎉1 2⋆(-8-0‿3‿1‿6)×⌜I∘⊣)¨200‿253‿451‿590}¨7‿12‿34×1e3
h ← 0.49 PanAP ∾ (9‿3‿4‿6÷9) × 2 Rep ((lb÷4)(+≍-)400) ↑¨ <0.4 × ¯5‿400‿0.8 Peak ¯4‿1500‿1 Peak (I 200) Fadefront ((•math.Sin ·+`(2×π)|8÷˜↕)×1⌊1.4×2⋆¯11×I)8e3

b ← 0.44 PanAP (1.4÷max) × 60 Hp2 ¯4‿180 LShelf ¯9‿12e3 HShelf ⊏ Read "bass"

Out ↩ max × 2 Softclip ÷⟜2
(4×lm) Write ⟨k,s,h,b⟩
