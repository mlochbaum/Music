#! /usr/bin/env dbqn

•state•Eval•FChars"synth.bqn"
lb←⌊⌾(÷⟜600)0.46×fr
factorCounts ← •Import "factc.bqn"
fa ← 10 Hp2 10 ÷˜ FactorCounts lb÷5
Poly ← {+⟜(𝕩⊸×)´𝕨}

Kg← {1(-÷+)⋆(1600÷𝕩)× 23‿0.81 Hp2q⍟16 ((2⋆÷⟜𝕩) × ·Triangle 0⌈43⊸+) ¯25÷˜↕lb}

w ← ∾ 7‿1‿0‿6‿1‿1/∾˜ ((4×lb)↑/⟜fa)¨ 32‿36‿27
l ← (4×lb) ↑ Kg 2
n0← ∾˘˝ 1‿0.9 × 0.41‿0.36 Pan⟜(23⥊∘↑⊢)˘ > (lb÷4) ((0.4×0.6⋆I∘⊣) × Square∘⥊)¨ (¯7+0‿¯2‿0⊸∾˘¯5‿¯7) Trans 1.5×fr÷32×2
n ← (12.48×lb) ↑˘ 20 Hp2 ¯12‿7e3‿2 Peak (-⌊lb÷2.05)(0.7⊸×+(0.3×⌽˘)+0.1×⌽˘⍟2) n0

map←". ··˙   .   ˙·· .  ·˙  ·. · ˙ · "
j ← (2×lb)↑Kg 31
k ← (map='·') (lb÷4){(⌊𝕗×0.07+(≠-¯1⊑/)𝕨) ⌽ ∾ (𝕗×(≠|·-⟜(¯1⊸⌽)/)𝕨) ↑¨<𝕩 } Kg 1.4
s ← 0¨⊸∾ lb ↑ 10‿80‿1 Peak 9‿280‿1 Peak 4e3 Lp1 (××2.2√|) ((¯1+2|1.2⋆3+(9×⋆2)|⋆⟜(¬4.3e¯5))×2⋆÷⟜¯900)↕8e3
h ← (24⊸Rep∾(3 Rep (lb÷6)⊸↑)∾6⊸Rep) ((2⋆¯7×I) × (¯1+2|π⋆˜↕) × 6e3 Hp1 Saw∘⥊⟜7456) lb÷4

b ← 70 Hp1 Clip ((¯2‿¯0.5‿10‿¯4 Poly ·Saw⥊⟜(Note"Gb1")) × 1+0.4×·Sine·-⟜(≠÷˜fr|+´) 2.5‿¯1‿20‿¯14 Poly I) 4×lb

Out ↩ max × 3 Softclip 0.3×20⊸Hp2
(64×lb) Write ⟨w,n,j,k,s,h,b⟩
